"use strict";(self.webpackChunkdrand_docs=self.webpackChunkdrand_docs||[]).push([[8789],{474:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>l,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var o=t(4848),i=t(8453);const s={slug:"fastnet-to-be-sunset",title:"fastnet to be sunset, long live quicknet",authors:["yolan"],tags:["news"],date:new Date("2023-07-02T00:00:00.000Z")},r=void 0,a={permalink:"/blog/fastnet-to-be-sunset",editUrl:"https://github.com/drand/drand-docs/tree/master/blog/2023-07-02-fastnet-to-be-sunset-long-live-quicknet.md",source:"@site/blog/2023-07-02-fastnet-to-be-sunset-long-live-quicknet.md",title:"fastnet to be sunset, long live quicknet",description:"Last month, we have identified\xa0a minor issue in our implementation of the BLS signature on G1 used in the newly launched\xa0fastnet\xa0network. This is an RFC compliance issue which led us to plan the launch of a new compliant\xa0quicknet\xa0network and to spin down\xa0fastnet.",date:"2023-07-02T00:00:00.000Z",tags:[{inline:!1,label:"News",permalink:"/blog/tags/news",description:"news tag"}],readingTime:3.8733333333333335,hasTruncateMarker:!0,authors:[{name:"Yolan Romailler",title:"Co-Founder & Cryptographer",description:"Applied cryptographer with a leaning for broader security/vulnerability research. \n\nWorked on the Distributed Randomness project, drand, at Protocol Labs and also on CBDC and SSI at SICPA, as well as broader cryptographic engineering at Kudelski Security. I've also been a Security Engineer on the Diem security team for Novi (Facebook/Meta).\nA subject matter expert in secure coding. As a consultant, I've supported customers by answering complex questions on security critical systems such as blockchain technologies, and by designing, evaluating and implementing complex cryptography such as key management systems or cryptographic primitives.\n",url:"https://romailler.ch/",page:{permalink:"/blog/authors/yolan"},socials:{linkedin:"https://www.linkedin.com/in/anomalroil/",github:"https://github.com/AnomalRoil",blog:"https://romailler.ch/"},imageURL:"https://media.licdn.com/dms/image/v2/C5603AQHKMl2eqMuNaw/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1587563958538?e=1731542400&v=beta&t=P3xWRN9Vxshih2vPsvbdBKWmBo8mH5rTQGQljBlMEYg",key:"yolan"}],frontMatter:{slug:"fastnet-to-be-sunset",title:"fastnet to be sunset, long live quicknet",authors:["yolan"],tags:["news"],date:"2023-07-02T00:00:00.000Z"},unlisted:!1,prevItem:{title:"Announcing Randamu!",permalink:"/blog/announcing-randamu"},nextItem:{title:"Announcing the drand Code Walkthroughs",permalink:"/blog/announcing-drand-code-walkthrough"}},c={authorsImageUrls:[void 0]},d=[{value:"The Issue",id:"the-issue",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Recommendations",id:"recommendations",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Last month, we have identified\xa0",(0,o.jsx)(n.a,{href:"https://github.com/drand/kyber-bls12381/issues/22",children:"**a minor issue"}),"** in our implementation of the BLS signature on G1 used in the newly launched\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network. This is an RFC compliance issue which led us to plan the launch of a new compliant\xa0",(0,o.jsx)(n.code,{children:"quicknet"}),"\xa0network and to spin down\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"the-issue",children:"The Issue"}),"\n",(0,o.jsxs)(n.p,{children:["While not a\xa0",(0,o.jsx)(n.em,{children:"security issue"}),"\xa0for drand, the problem is affecting our \u201chash to curve\u201d function, used to map round numbers to a point on the elliptic curve that get signed using\xa0",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/BLS_digital_signature",children:"**threshold BLS"}),"** by the drand network. The issue relates to the upcoming Hash To Curve\xa0",(0,o.jsx)(n.a,{href:"https://www.rfc-editor.org/auth48/rfc9380",children:(0,o.jsx)(n.strong,{children:"RFC 9380"})}),", which mandates specific \u201cDomain Separation Tags\u201c (DST) for certain curves. In the BLS curve case, where we have two different groups (G1 and G2) that we can map to, the RFC recommends using different DST for both groups (it\u2019s the point of having a DST!). Sadly, our implementation of BLS signatures was initially written to perform signatures on G2 and not on G1\u2026 (Stay tuned for an upcoming blog post about the choice of the group for BLS signatures!) The usage of a global variable in our codebase for the DST meant that both our G1 and G2 implementations were sharing the same DST. Since we don\u2019t have \u201cofficial test vectors\u201d for BLS signatures on G1 and G2, this went unnoticed until\xa0",(0,o.jsx)(n.a,{href:"https://drandworkspace.slack.com/archives/C011JB8NU2E/p1683527867397549?thread_ts=1683197659.071499&cid=C011JB8NU2E",children:"**someone tried"}),"** to verify our signatures done on G1 with a C++ implementation and reported the issue in our Slack."]}),"\n",(0,o.jsxs)(n.p,{children:["We launched our\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0Testnet in February to try and identify any potential issues, while also allowing people to start building their applications on top of our new design featuring\xa0",(0,o.jsx)(n.a,{href:"https://www.notion.so/2-1-Concepts-Cryptography-6b6cea36929e4b1b8ed5b00ad8600081?pvs=21",children:(0,o.jsx)(n.strong,{children:"unchained randomness"})})," and\xa0",(0,o.jsx)(n.a,{href:"Timelock%20Encryption%20is%20now%20supported%20on%20drand%20main%20327425b1e16d4c22aa0d785dbf1c5fbb.md",children:(0,o.jsx)(n.strong,{children:"timelock capabilities"})}),". Despite this, the issue went unnoticed in all signature verification implementations that we tried with our drand beacons (including our typescript\xa0",(0,o.jsx)(n.a,{href:"https://github.com/drand/drand-client",children:"**drand-client"}),"** codebase and two different third party Rust implementations of drand verification!). Amusingly, within weeks of this issue being identified, a second team, building their own timelock scheme on top of our new\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network, also identified the issue and reported it to us."]}),"\n",(0,o.jsx)(n.p,{children:"For us, the main takeaways here are:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Make sure to have as many test vectors as possible, generated using multiple, different implementations."}),"\n",(0,o.jsx)(n.li,{children:"Generate more noise and community outreach around new network launches, including new testnets."}),"\n",(0,o.jsx)(n.li,{children:"Expect early adopters to take at least 2-3 months to start testing their implementations building on top of your new features, and therefore plan your testnet and mainnet launches accordingly."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(n.p,{children:["This issue means that\xa0",(0,o.jsx)(n.strong,{children:"all beacons"}),"\xa0emitted for the new\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network that we launched on March 1st are featuring signatures that are non-compliant with the hash to curve spec, and so is the case for beacons from our testnet."]}),"\n",(0,o.jsxs)(n.p,{children:["While not a\xa0",(0,o.jsx)(n.em,{children:"security"}),"\xa0issue for our usage, using the wrong domain separator tag to map points on G1 is non-compliant with the RFC and therefore not great for future compatibility and adoption of our new network. We have\xa0",(0,o.jsx)(n.a,{href:"https://github.com/drand/drand/pull/1249",children:"**already implemented a new, RFC-compliant scheme"}),"** for drand, affectionately named\xa0",(0,o.jsx)(n.code,{children:"bls-unchained-g1-rfc9380"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"During investigations, we identified 4 main ways to solve this issue:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Do nothing and document the non-compliance"}),"\xa0of the signatures on the drand website, however this would have caused significant friction for future adoption, reducing the usability and the developer experience of drand."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["Create a new\xa0",(0,o.jsx)(n.code,{children:"quicknet"}),"\xa0network and keep the existing\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network running"]}),", causing a 90% increase of the load of our existing nodes, forcing us to increase our tech debt and maintenance burden but not disrupting any existing users. (The verifiability of drand beacons allows our users to re-use them or redistribute them without us knowing about it. This further means that we do not have visibility into our user-base, and therefore, getting in contact with them to notify them of a \u201c",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0shutdown\u201d is not an option)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Create a new"}),"\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0",(0,o.jsxs)(n.strong,{children:["network (",(0,o.jsx)(n.code,{children:"quicknet"}),")"]}),"\xa0using a\xa0",(0,o.jsx)(n.strong,{children:"compliant implementation"}),"\xa0of the signature function and\xa0",(0,o.jsx)(n.strong,{children:"shutdown"}),"\xa0the existing non-compliant one immediately. This would inevitably cause our current\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0users to be completely stranded and having to switch quickly to our new\xa0",(0,o.jsx)(n.code,{children:"quicknet"}),"\xa0network, causing serious disruption for our users."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Create a new"}),"\xa0",(0,o.jsx)(n.code,{children:"quicknet"}),"\xa0",(0,o.jsx)(n.strong,{children:"network"}),"\xa0using a\xa0",(0,o.jsx)(n.strong,{children:"compliant implementation"}),"\xa0of the signature function and\xa0",(0,o.jsx)(n.strong,{children:"sunset"}),"\xa0the existing one over multiple months before\xa0",(0,o.jsx)(n.strong,{children:"shutting it down entirely"}),". This would allow our users to ensure 100% uptime of their services, while gradually migrating to the new network."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Given the above, ",(0,o.jsx)(n.a,{href:"https://www.notion.so/The-League-of-Entropy-1e76674b75e249699445799c5083fe78?pvs=21",children:"The League of Entropy"})," has voted and elected to choose the last option, using its governance process, and therefore will:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Sunset"}),"\xa0the current\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network, reduce the number of Mainnet nodes running it (from 21 with a\xa0",(0,o.jsx)(n.strong,{children:"threshold of 11"}),"\xa0to a committee of 14 with a\xa0",(0,o.jsx)(n.strong,{children:"threshold of 8"}),"), stop onboarding new nodes to it, and most importantly\xa0",(0,o.jsx)(n.strong,{children:"stop it entirely"}),"\xa0as soon as possible."]}),"\n",(0,o.jsxs)(n.li,{children:["launch a new\xa0",(0,o.jsx)(n.code,{children:"quicknet"}),"\xa0network with the same settings, e.g. 3 seconds frequency, 2 seconds catch-up period,\xa0",(0,o.jsx)(n.a,{href:"Multi-Frequency%20Support%20&%20Timelock%20Encryption%20are%20%205c3651ad243541b698024016ecd24d26.md",children:"**unchained randomness"}),"** (thus compatible with timelock schemes), except it would be using our newly released\xa0",(0,o.jsx)(n.code,{children:"bls-unchained-g1-rfc9380"}),"\xa0scheme which is RFC-compliant."]}),"\n",(0,o.jsxs)(n.li,{children:["do the same on our Testnet\xa0",(0,o.jsx)(n.code,{children:"testnet-g"}),"\xa0network, shutting it down before Mainnet, in order to allow us to effectively test the shutdown scenario."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["We are currently planning to launch these new\xa0",(0,o.jsx)(n.code,{children:"quicknet"}),"\xa0networks in July on both our Testnet and Mainnet."]}),"\n",(0,o.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,o.jsxs)(n.p,{children:["The biggest problem with shutting down our\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network, is that any usage of its public key to perform timelock encryption past the shutdown date will lead to ciphertexts that cannot be decrypted. This is because the required beacon\u2019s signature won\u2019t be emitted by the network. This means that whoever used our timelock system with our\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network (or our\xa0",(0,o.jsx)(n.code,{children:"testnet-g"}),"\xa0one) and set a decryption date after their shutdown date won\u2019t be able to decrypt their ciphertexts."]}),"\n",(0,o.jsx)(n.p,{children:"For \u201cclassical\u201d public randomness usage, switching to a new network does not affect the quality or verifiability of the randomness."}),"\n",(0,o.jsx)(n.h2,{id:"recommendations",children:"Recommendations"}),"\n",(0,o.jsx)(n.p,{children:"For \u201cpublic verifiable randomness usage\u201d, we recommend always having a way to transition to a new \u201cbeacon chain\u201d easily shall the need arise. This means being able to switch to a new public key and starting to monitor a new chainhash at a given time."}),"\n",(0,o.jsxs)(n.p,{children:["If you are working on a\xa0",(0,o.jsx)(n.strong,{children:"timelock"}),"-based system relying on our\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0be aware that you\u2019ll need to either launch a new version of your application in July, or plan a way to transition to our new network, and that any ciphertexts meant for December, or later, on\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0are not going to be decryptable after that point. The League of Entropy members will be deleting their secret shares allowing them to perform the threshold operations required to produce valid signatures for the group. We recommend communicating to your users that they\u2019ll need to re-issue any such ciphertexts using the new network if they want them to be decryptable after December 2023."]}),"\n",(0,o.jsxs)(n.p,{children:["If you are using our\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0for randomness, plan your transition to the new network by the end of Q3\u20192023."]}),"\n",(0,o.jsxs)(n.p,{children:["Please, don\u2019t hesitate to reach us (for example on\xa0",(0,o.jsx)(n.a,{href:"https://join.slack.com/t/drandworkspace/shared_invite/zt-19u4rf6if-bf7lxIvF2zYn4~TrBwfkiA",children:(0,o.jsx)(n.strong,{children:"our Slack"})}),") in case you have any concerns or if your current\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0usage cannot accommodate a shutdown of the\xa0",(0,o.jsx)(n.code,{children:"fastnet"}),"\xa0network by the end of the year."]}),"\n",(0,o.jsx)(n.p,{children:"Stay tuned for more blog posts about the groups G1 and G2 and how to choose the right one when doing BLS signatures, as well as for the quicknet launch announcement after our new upcoming Distributed Key Generation ceremony. See you on quicknet in July!"}),"\n",(0,o.jsx)(n.hr,{})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var o=t(6540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);